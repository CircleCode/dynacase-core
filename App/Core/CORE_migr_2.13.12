#!/bin/bash
if [ "$pgservice_core" == "" ]; then
    # load environement variable for freedom
    . /etc/freedom.conf
    wchoose -b
fi

echo "ALTER TABLE usertoken ADD COLUMN expendable boolean DEFAULT FALSE;" | PGSERVICE="$pgservice_core" psql
RET=$?
if [ $RET -ne 0 ]; then
    echo "Error altering table 'usertoken'"
    exit $RET
fi

echo "ALTER TABLE style ALTER COLUMN description TYPE text;" | PGSERVICE="$pgservice_core" psql
RET=$?
if [ $RET -ne 0 ]; then
    echo "Error altering  table 'style'"
    exit $RET
fi

(cd $wpub/STYLE/ && ls -1) \
    | while read STYLE; do
    $wpub/wsh.php --api=import_style --name="$STYLE"
done
