<style type="text/css">

#help-lang-name {
	vertical-align: middle;
}
#help-langs a {
	outline: 0;
}
#help-langs {
	float: right;
}
#help-langs img {
	border: 1px solid [CORE_BGCOLOR];
	padding: 0 3px;
}
#help-langs a.current img {
	background: [COLOR_B9];
	border-color: [COLOR_B5];
}
#help-langs a.active img {
	background: [CORE_BGCOLOR];
	border-color: [COLOR_A7];
}
#help-langs .help-section-langs a.active:hover img {
	background: [COLOR_A9];
	border-color: [COLOR_A5];
}
#help-langs a.inactive {
	opacity: 0.25;
	-moz-opacity: 0.25;
	-webkit-opacity: 0.25;
}
#help-sections .help-section-langs img {
	border: 1px solid [CORE_BGCOLOR];
	padding: 0 3px;
}
#help-sections .help-section-langs a.current img {
	background: [COLOR_B9];
	border-color: [COLOR_B5];
}
#help-sections .help-section-langs a.active img {
	background: [CORE_BGCOLOR];
	border-color: [COLOR_A7];
}
#help-sections .help-section-langs a.active:hover img {
	background: [COLOR_A9];
	border-color: [COLOR_A5];
}
#help-sections .help-section-langs a.inactive {
	opacity: 0.25;
	-moz-opacity: 0.25;
	-webkit-opacity: 0.25;
}
#help-sections .help-section-langs a:hover {
	background:none;
}
#help-sections .help-section {
	margin: 0 0 2em 0;
}
.help-section-title {
	color: [COLOR_B0];
	font-weight: bold;
	font-size: 16px;
}
#help-sections .help-section-langs {
	float: right;
}
.help-section-text {
	margin-left: 24px;
}
</style>

<div style="display:block">
[ZONE FDL:EDITARRAY?arrayid=HELP_T_HELP]
[ZONE FDL:EDITARRAY?arrayid=HELP_T_SECTIONS]
</div>

<fieldset><legend>[TEXT:Online help]</legend>
	<div id="help-langs">
	[BLOCK HELPLANGS]
		<a href="#[LANGKEY]" id="help-langs-[LANGKEY]" class="[LANGCLASS]" title="[LANGNAME]" onclick="return help_change_lang(this,'[LANGKEY]')"><img src="[IMG:flags/[LANGISO].png|16]" title="[LANGNAME]" width="16" height="16" /></a>
	[ENDBLOCK HELPLANGS]
		<br />
		<a onclick="return help_open_subwindow(event,'help_t_help');">[TEXT:Edit translations]</a>
	</div>

	<div class="help-section-item">
		<div class="help-section-title">[TEXT:Help name]</div>
		<div class="help-section-text" id="help-name">[HELPNAME]</div>
	</div>
	
	<div class="help-section-item">
		<div class="help-section-title">[TEXT:Help description]</div>
		<div class="help-section-text" id="help-description">[HELPDESCRIPTION]</div>
	</div>
	
</fieldset>

<fieldset id="help-sections"><legend>[TEXT:Sections]</legend>

<input type="hidden" name="edit_section_key" value="" id="edit_section_key" />

[BLOCK CONTENTSECTIONS]
	<div class="help-section" id="sec-[SECKEY]">
		<div class="help-section-langs">
			[BLOCK [SECTIONLANGS]]
			<a href="#[LANGKEY]" class="[LANGCLASS]" title="[LANGNAME]" onclick="return help_change_lang_section(this,'[SECKEY]','[LANGKEY]')"><img src="[IMG:flags/[LANGISO].png|16]" title="[LANGNAME]" width="16" height="16" /></a>
			[ENDBLOCK [SECTIONLANGS]]
			<br />
			<a onclick="return help_open_subwindow(event,'help_t_sections','[SECKEY]');">[TEXT:Edit translations]</a>
		</div>

		[BLOCK [SECTIONITEMS]]
		<div class="help-section-item" style="display:[SECDISPLAY]" id="sec-[SECKEY]-[SECLANG]">
			<div class="help-section-title">[SECNAME]</div>
			<div class="help-section-text">[SECTEXT]</div>
		</div>
		[ENDBLOCK [SECTIONITEMS]]

	</div>
[ENDBLOCK CONTENTSECTIONS]

</fieldset>

<script type="text/javascript">
var LANGS = [JSONLANGS];

function help_get_current_lang() {
	for(var lang in LANGS) {
		var a = document.getElementById('help-langs-'+lang);
		if(a.className == 'current') {
			return lang;
		}
	}
	return false;
}

function help_change_lang_section(obj, seckey, langkey) {
	if(obj.className == 'inactive') {
		return false;
	}
	var i=0;
	for(var lang in LANGS) {
		if(obj.parentNode.childNodes[i].className != 'inactive') {
			obj.parentNode.childNodes[i].className = 'active';
		}
		if(lang == langkey) {
			document.getElementById('sec-'+seckey+'-'+lang).style.display='block';
		}
		else {
			document.getElementById('sec-'+seckey+'-'+lang).style.display='none';
		}
		i++;
	}
	obj.className = 'current';
	return false;
}

function help_reload_help_langs() {
	// init
	var help_langs = getFormValue('help_lang');
	var help_names = getFormValue('help_name');
	var help_descriptions = getFormValue('help_description');
	var current_lang = '';
	var new_current = '';
	// no lang at all
	if(!help_langs) {
		for(var lang in LANGS) {
			var a = document.getElementById('help-langs-'+lang);
			a.className = 'inactive';
		}
		document.getElementById('help-name').innerHTML = '';
		document.getElementById('help-description').innerHTML = '';
		return true;
	}
	// search current lang
	for(var lang in LANGS) {
		var a = document.getElementById('help-langs-'+lang);
		if(a.className == 'current') {
			current_lang = lang;
			break;
		}
	}
	// redefine class for flag links
	for(var lang in LANGS) {
		var a = document.getElementById('help-langs-'+lang);
		var found = -1;
		for(var i=0; i< help_langs.length; i++) {
			if(help_langs[i] == lang) {
				found = i;
				break;
			}
		}
		if(found >= 0) {
			if(lang == current_lang) {
				a.className = 'current';
				new_current = lang;
				help_change_lang(a, lang);
			}
			else {
				a.className = 'active';
			}
		}
		else {
			a.className = 'inactive';
		}
	}
	// if no current lang, set current the first active
	if(new_current == '') {
		for(var lang in LANGS) {
			var a = document.getElementById('help-langs-'+lang);
			if(a.className == 'active') {
				a.className == 'current';
				new_current = lang;
				help_change_lang(a, lang);
			}
		}
	}
	// if always no current lang, empty fields
	if(new_current == '') {
		document.getElementById('help-name').innerHTML = '';
		document.getElementById('help-description').innerHTML = '';
	}
}

function help_change_lang(obj,langkey) {
	if(obj.className == 'inactive') {
		return false;
	}
	var help_langs = getFormValue('help_lang');
	var help_names = getFormValue('help_name');
	var help_descriptions = getFormValue('help_description');
	for(var i=0;i < help_langs.length; i++) {
		if(help_langs[i] == langkey) {
			document.getElementById('help-name').innerHTML = help_names[i];
			document.getElementById('help-description').innerHTML = help_descriptions[i].replace(/\n/g, "<br />");
			var flags = document.getElementById('help-langs').childNodes;
			for(var j=0; j < flags.length; j++) {
				if(flags[j].className == 'current') {
					flags[j].className = 'active';
				}
			}
		}
	}
	obj.className = 'current';
	return false;
}

function help_open_subwindow(event,attrname,seckey) {
	var o = document.getElementById('tispecial'+attrname);
	if(seckey) {
		document.getElementById('edit_section_key').value = seckey;
	}
	if(o) {
		o.onclick.apply(null,[event]);
	}
	else {
		alert('Ooops, something that\'s shouldn\'t occur just happens !');
	}
	return false;
}
</script>