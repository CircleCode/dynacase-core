<VirtualHost *>

ServerName freedom
DocumentRoot /usr/share/what
Alias /what /usr/share/what
Alias /freedom /usr/share/what

LogFormat "%{X-Forwarded-For}i %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
ErrorLog  /var/log/apache2/freedom-error_log
CustomLog /var/log/apache2/freedom-access_log combined
CustomLog /var/log/apache2/freedom-referer_log referer
CustomLog /var/log/apache2/freedom-agent_log agent


<Directory "/usr/share/what">
    AddType application/x-httpd-php .php
    DirectoryIndex  index.php
    <Files ~ "index.php">
      ErrorDocument 401 /what/expire/tryexpire.html

      <IfModule mod_authn_pam.c>
        AuthType Basic
        AuthName 'FREEDOM Connection'      
        AuthBasicProvider pam
        AuthnPAMService httpd
        Require valid-user
      </IfModule>

    </Files>
    <FilesMatch "\.conf|dbaccess.php|wstop|wcheck|wcontrol|wsh.php">
       Order Deny,Allow
       Deny from All   
    </FilesMatch>
    <FilesMatch "\.(gif|jpe?g|png|xpm|ico|js|html|css)$">
       Order Deny,Allow
       Allow from All   
    </FilesMatch>
    <FilesMatch "geticon.php">
      Allow from All

      <IfModule mod_authn_pam.c>
        AuthType Basic
        AuthName 'FREEDOM Connection'  
        AuthBasicProvider pam
        AuthnPAMService httpd
        Require valid-user
      </IfModule>

    </FilesMatch>
    <FilesMatch "expire.shtml|chgpasswd.php">
      Allow from All

      <IfModule mod_authn_pam.c>
        AuthType Basic
        AuthName 'FREEDOM Connection'
        AuthBasicProvider pam
        AuthnPAMService httpdwa
        Require valid-user
      </IfModule>

    </FilesMatch>
    ExpiresActive On
    ExpiresByType application/x-javascript  A31536000
</Directory>



<Directory ~ /usr/share/what/[A-B,D-Z]|/usr/share/what/C[^A]>
     Order Deny,Allow
     Deny from All   
</Directory> 

<Directory "/usr/share/what/expire/">
    ErrorDocument 401 "connection refused"   
    Options IncludesNoExec FollowSymLinks 
</Directory>

<Directory "/usr/share/what/admin/">
    DirectoryIndex  winit.php

    php_value session.name "adminsession"
    php_value session.use_cookies 1

    AuthType Basic
    AuthName "FREEDOM Administration"
    AuthUserFile /usr/share/what/admin/.htpasswd
    Require valid-user
</Directory>

<Directory /usr/share/what/CALENDAR>
    AllowOverride None
    ErrorDocument 401 "connection refused"

    <IfModule mod_authn_pam.c>
      AuthType Basic
      AuthName 'FREEDOM Connection'
      AuthBasicProvider pam
      AuthnPAMService httpdwa
      require valid-user
    </IfModule>

</Directory>

Include /etc/apache2/freedom.d

#Alias /whatsync /usr/share/what/CALENDAR
</VirtualHost>
